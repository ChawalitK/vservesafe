((setting_id,api,test,includePlugin)=>{let helper=window._tr||{};let ab_id=setting_id;let excludes=[];let site="";if(window["onWidgetReady_"+setting_id]){window["onWidgetReady_"+setting_id]();}
const is_test="false";const fonts={KaLaTeXa_Display:"KaLaTeXa_Display",cloudsemibold:"cloudsemibold",cloudregular:"cloudregular",};const div_id=`tr-${setting_id}`;const article_id=document.getElementById(div_id).getAttribute("data-article-id");const plugins=[];let url=`${api}/articles/get/${setting_id}`;if(article_id){url+=`/${article_id}`;}
const initScript=()=>{jsonp(url,null,function(data){if(window["onDataLoaded_"+setting_id]){window["onDataLoaded_"+setting_id](data);}
callPluginFunc("onDataLoaded",data);if(data.ab_id){ab_id=data.ab_id;}
site=data.on_site;renderStyle(data.style);renderTemplate(data.template,data);if(is_test==="true"){window["onTemplateChange_"+setting_id]=(html,style)=>{try{renderTemplate(html,data);renderStyle(style);}catch(e){}};}});};const renderStyle=(style)=>{if(typeof ejs==="undefined"){setTimeout(()=>{renderStyle(style);},100);return;}
const style_id=`tr-style-${setting_id}`;const style_el=helper.id(style_id);if(style_el){style_el.innerHTML=style;}else{const style_el=document.createElement("style");style_el.id=style_id;style_el.innerHTML=ejs.render(style,{...fonts});document.getElementsByTagName("head")[0].appendChild(style_el);}};const filterData=(data,limit)=>{excludes=excludes.concat(data.map((item)=>item.id));return data;const viewed=getLocalStorage();const filtered=data.filter((item)=>!viewed.find((item2)=>item.id===item2.id));let limited;if(filtered.length!==0){limited=filtered.slice(0,limit);}else{limited=data.slice(0,limit);}
return limited;};const updateLocalSorage=(id)=>{const viewed=getLocalStorage();if(!viewed.find((item)=>item.id===id)){viewed.push({id,exp:Date.now()+86400000});localStorage.setItem("tr-readed",JSON.stringify(viewed));}};const checkExpireLocalstorage=()=>{const viewed=getLocalStorage();viewed.map((items,index)=>{if(Date.now()>items.exp){delete viewed[index];}});const filtered=viewed.filter((el)=>{return el!=null;});localStorage.setItem("tr-readed",JSON.stringify(filtered));};const getLocalStorage=()=>{const storage=localStorage.getItem(`tr-readed`);const viewed=storage?JSON.parse(storage):[];return viewed;};const clearActiveLoadmore=()=>{const q=document.querySelector("._tr-a-loadmore-item:last-child");if(q){q.classList.add("hide");}};let loadmorePage=1;const renderTemplate=(template,data,append=false)=>{if(typeof ejs==="undefined"){setTimeout(()=>{renderTemplate(template,data);},100);return;}
const{title,items,limit}=data;const _data=filterData(items,limit);if((_data||[]).length===0){return;}
const obj={title:title,items:_data.map((item,i)=>({title:item.title||"#",id:item.id||"",url:(item.canonical||"")+
"#"+
btoa("id="+setting_id+"&pos="+i+"&rule="+item.rule),sub_title:item.sub_title||"",image:item.image||"",thumbnail:item.thumbnail||"",description:item.description||"",sub_description:item.sub_description||"",date:helper.getThaiDate(item.published_at||""),contentType:item.contentType||"",premiumType:item.premiumType||"",tags:item.tags||[],sub_categories:item.sub_categories,ai:item.ai||null,categories:{name:((item.categories||[{}])[0]||{}).name||"uncategorize",url:((item.categories||[{}])[0]||{}).url+
"#"+
btoa("id="+
setting_id+
"&cat="+
((item.categories||[{}])[0]||{}).path+
"&rule="+
item.rule),},published_at:item.published_at||"",})),};const html=ejs.render('<div class="__tr-reco-imp">'+template+"</div>",obj);if(data.items.length<limit){clearActiveLoadmore();}
if(append){var div=document.createElement("div");div.innerHTML=html.trim();const childs=div.querySelectorAll("._tr-item-widget");for(const child of childs){helper.id(div_id).querySelector("._tr-grid-item").appendChild(child);}}else{helper.id(div_id).innerHTML=html;}
if(window["onRendered_"+setting_id]){window["onRendered_"+setting_id]();}
const onClickLoadmore=(page)=>{loadmorePage++;let __params={};if(window["beforeSendEvent_"+setting_id]){__params=window["beforeSendEvent_"+setting_id]("loadmore");}
helper.event(ab_id,{type:"loadmore",widget_site:site,...__params,});const div=document.getElementById("_tr-loadmore-item");for(const child of div.children){child.setAttribute("class","_tr-a-loadmore-item");}
const query="?page="+page+"&excludes="+excludes.join(",");jsonp(url,query,function(data){if(window["onDataLoaded_"+setting_id]){window["onDataLoaded_"+setting_id](data);}
if(data.ab_id){ab_id=data.ab_id;}
renderTemplate(data.template,data,true);if(is_test==="true"){window["onTemplateChange_"+setting_id]=(html,style)=>{try{renderTemplate(html,data,true);}catch(e){}};}});};const onClickLoadmoreTimeline=(e)=>{helper.event(ab_id,{type:"loadmore",widget_site:site,});const timelineId=e.target.dataset.id;const el=document.querySelector('div[data-id="'+timelineId+'"]');const limit=el.dataset.limit;const ch=el.querySelectorAll("._tr-item-widget.hide");if(ch.length<limit){e.target.classList.add("hide");}
for(let i=0;i<ch.length;i++){if(i<limit){ch[i].classList.remove("hide");}else{break;}}};document.querySelectorAll("#tr-"+setting_id+" a").forEach((el,i)=>{if(!el.classList.contains("__tr-reco-click")){el.classList.add("__tr-reco-click");}
const img=el.querySelector("img");if(img){el.querySelector("img").className+=" __tr-reco-click";}
const addEventClick=(e)=>{e.preventDefault();const a=e.target.tagName!=="A"?e.target.closest("a"):e.target;const link=a.href.indexOf("#")+1;if(e.target.className==="_tr-a-loadmore-item __tr-reco-click"){onClickLoadmore(loadmorePage);el.removeEventListener("click",addEventClick);}else if(e.target.className.match("_tr-a-loadmore-timeline-item")){onClickLoadmoreTimeline(e);}
if(link===0){location.href=a.href;return;}
const click_info=atob(a.href.substr(link));const _click_info=click_info.split("&");const click_pos=_click_info[1].split("=");const click_rule=_click_info[2].split("=");const event_obj={type:"click",click_link:a.href.substr(0,a.href.indexOf("#")),widget_site:site,};if(click_pos){event_obj[click_pos[0]]=click_pos[1];}
if(click_rule){event_obj[click_rule[0]]=click_rule[1];}
let __params={};if(window["beforeSendEvent_"+setting_id]){__params=window["beforeSendEvent_"+setting_id]("click");}
helper.event(ab_id,{...event_obj,...__params});location.href=a.href;};el.addEventListener("click",addEventClick);});const rules=_data.map((item)=>item.rule);helper.checkVisiblity(setting_id,(i)=>{if(obj.items[i]){updateLocalSorage(obj.items[i].id);}
if(!(helper.imp_widget||[]).includes(setting_id)){helper.imp_widget.push(setting_id);let __params={};if(window["beforeSendEvent_"+setting_id]){__params=window["beforeSendEvent_"+setting_id]("imp_widget");}
helper.event(ab_id,{type:"imp_widget",widget_site:site,...__params,});}});checkExpireLocalstorage();};const callPluginFunc=(func,data)=>{const result=[];plugins.forEach((plugin)=>{if(plugin[func]){const q=plugin[func](data);if(q)result.push(q);}});return result;};const jsonp=function(url,query,callback){const callback_name=`cb_${setting_id}`;const script=document.createElement("script");query=query?query:"?";script.src=url+
query+
"&callback="+
callback_name+
"&client="+
helper.clientInfo();const plugin_query=callPluginFunc("getQueryBeforeCallData");script.src+="&"+plugin_query.join("&");script.type="text/javascript";script.async=true;window[callback_name]=callback;if(window["onCallData_"+setting_id]){window["onCallData_"+setting_id](script.src);}
document.body.appendChild(script);};const registerPlugins=function(helper){(document.getElementById(div_id).getAttribute("data-plugin-list")||"").split(",").forEach((item)=>{if(item&&item.trim()!==""){const p=includePlugin.find((p)=>p.name===item);if(p){plugins.push(p.register(helper));}}});};const initInterval=setInterval(function(){if(typeof window._tr==="undefined"){return;}
clearInterval(initInterval);helper=window._tr;helper.is_test=is_test==="true";helper.endpoint=api;registerPlugins(helper);initScript();},100);const child=document.createElement("script");child.setAttribute("type","text/javascript");child.setAttribute("src",api+"/js/tr-rec.core.min.js?v=1688976959906");document.getElementsByTagName("head")[0].appendChild(child);})("626a4a3adeb9790013640717","https://rec.thairath.co.th","false",[{name:"tr-beh",register:(helper)=>{const getQueryBeforeCallData=()=>{const query=getBehavior();if(query){return "beh_site=trol&behavior="+JSON.stringify(query);}
return "";};const getBehavior=()=>{const beh=helper.getCookie("TRRec_Beh");return beh||{};};const onDataLoaded=()=>{const url=window.location.href;const section=_getSection(url);if(section){const _beh=getBehavior();const _inc=_beh&&_beh[section]?++_beh[section]:1;helper.setCookie("TRRec_Beh",{..._beh,[section]:_inc});}};const _getSection=(url)=>{let s=null;if(url.match(/news\/business/)){s="bu";}else if(url.match(/entertain/)){s="en";}else if(url.match(/horoscope/)){s="ho";}else if(url.match(/lifestyle/)){s="li";}else if(url.match(/lottery/)){s="lo";}else if(url.match(/novel/)){s="no";}else if(url.match(/scoop/)){s="sc";}else if(url.match(/sport/)){s="sp";}else if(url.match(/news/)){s="ne";}else if(url.match(/localhost/)){s="dev";}
return s;};return{getQueryBeforeCallData,getBehavior,onDataLoaded,_getSection,};},},]);